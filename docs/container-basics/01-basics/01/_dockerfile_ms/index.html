<!doctype html><html itemscope itemtype=http://schema.org/WebPage lang=en class=no-js><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><link rel="shortcut icon" href=../../../../../favicons/favicon.ico><link rel=apple-touch-icon href=../../../../../favicons/apple-touch-icon-180x180.png sizes=180x180><link rel=icon type=image/png href=../../../../../favicons/favicon-16x16.png sizes=16x16><link rel=icon type=image/png href=../../../../../favicons/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=../../../../../favicons/android-36x36.png sizes=36x36><link rel=icon type=image/png href=../../../../../favicons/android-48x48.png sizes=48x48><link rel=icon type=image/png href=../../../../../favicons/android-72x72.png sizes=72x72><link rel=icon type=image/png href=../../../../../favicons/android-96x96.png sizes=96x96><link rel=icon type=image/png href=../../../../../favicons/android-144x144.png sizes=144x144><link rel=icon type=image/png href=../../../../../favicons/android-192x192.png sizes=192x192><title>MultiStage Build | Container Security Training</title>
<meta name=description content="Often you&amp;rsquo;re going to use some kind of libraries, tools or dependencies during the build phase of your application that are not necessary during the runtime of the container. To improve security and efficiency we only include whats absolutely necessary in the image. So we often remove these dependencies in the build phase after the application itself has been built.
In this lab you&amp;rsquo;re going to learn how to use multistage builds and what they are good for."><meta property="og:title" content="MultiStage Build"><meta property="og:description" content="Often you&rsquo;re going to use some kind of libraries, tools or dependencies during the build phase of your application that are not necessary during the runtime of the container. To improve security and efficiency we only include whats absolutely necessary in the image. So we often remove these dependencies in the build phase after the application itself has been built.
In this lab you&rsquo;re going to learn how to use multistage builds and what they are good for."><meta property="og:type" content="article"><meta property="og:url" content="/docs/container-basics/01-basics/01/_dockerfile_ms/"><meta property="article:section" content="docs"><meta property="article:modified_time" content="2024-10-31T16:41:06+01:00"><meta itemprop=name content="MultiStage Build"><meta itemprop=description content="Often you&rsquo;re going to use some kind of libraries, tools or dependencies during the build phase of your application that are not necessary during the runtime of the container. To improve security and efficiency we only include whats absolutely necessary in the image. So we often remove these dependencies in the build phase after the application itself has been built.
In this lab you&rsquo;re going to learn how to use multistage builds and what they are good for."><meta itemprop=dateModified content="2024-10-31T16:41:06+01:00"><meta itemprop=wordCount content="450"><meta itemprop=keywords content><meta name=twitter:card content="summary"><meta name=twitter:title content="MultiStage Build"><meta name=twitter:description content="Often you&rsquo;re going to use some kind of libraries, tools or dependencies during the build phase of your application that are not necessary during the runtime of the container. To improve security and efficiency we only include whats absolutely necessary in the image. So we often remove these dependencies in the build phase after the application itself has been built.
In this lab you&rsquo;re going to learn how to use multistage builds and what they are good for."><link rel=preload href=../../../../../scss/main.min.adaeead791a8f109b4559b249a7a020bb877ffc11fefeb15be29f9b5a0346557.css as=style><link href=../../../../../scss/main.min.adaeead791a8f109b4559b249a7a020bb877ffc11fefeb15be29f9b5a0346557.css rel=stylesheet integrity><script src=https://code.jquery.com/jquery-3.7.1.min.js integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin=anonymous></script><script defer src=https://unpkg.com/lunr@2.3.9/lunr.min.js integrity=sha384-203J0SNzyqHby3iU6hzvzltrWi/M41wOP5Gu+BiJMz5nwKykbkUx8Kp7iti0Lpli crossorigin=anonymous></script></head><body class=td-page><header><nav class="td-navbar js-navbar-scroll" data-bs-theme=dark><div class="container-fluid flex-column flex-md-row"><a class=navbar-brand href=../../../../../><span class="navbar-brand__logo navbar-logo"></span><span class=navbar-brand__name>Container Security Training</span></a><div class="td-navbar-nav-scroll ms-md-auto" id=main_navbar><ul class=navbar-nav><li class=nav-item><a class=nav-link href=../../../../../setup/><span>Setup</span></a></li><li class=nav-item><a class="nav-link active" href=../../../../../docs/><span>Labs</span></a></li><li class=nav-item><a class=nav-link href=../../../../../slides/><span>Slides</span></a></li><li class=nav-item><a class=nav-link href=https://songlaa.com target=_blank rel=noopener><span>songlaa gmbh</span></a></li></ul></div><div class="d-none d-lg-block"><div class="td-search td-search--offline"><div class=td-search__icon></div><input type=search class="td-search__input form-control" placeholder="Search this site…" aria-label="Search this site…" autocomplete=off data-offline-search-index-json-src=../../../../../offline-search-index.04a0a1ad14436e1fd1a6224af726b016.json data-offline-search-base-href=../../../../../ data-offline-search-max-results=10></div></div></div></nav></header><div class="container-fluid td-outer"><div class=td-main><div class="row flex-xl-nowrap"><aside class="col-12 col-md-3 col-xl-2 td-sidebar d-print-none"><div id=td-sidebar-menu class=td-sidebar__inner><form class="td-sidebar__search d-flex align-items-center"><div class="td-search td-search--offline"><div class=td-search__icon></div><input type=search class="td-search__input form-control" placeholder="Search this site…" aria-label="Search this site…" autocomplete=off data-offline-search-index-json-src=../../../../../offline-search-index.04a0a1ad14436e1fd1a6224af726b016.json data-offline-search-base-href=../../../../../ data-offline-search-max-results=10></div><button class="btn btn-link td-sidebar__toggle d-md-none p-0 ms-3 fas fa-bars" type=button data-bs-toggle=collapse data-bs-target=#td-section-nav aria-controls=td-section-nav aria-expanded=false aria-label="Toggle section navigation"></button></form><nav class="td-sidebar-nav collapse" id=td-section-nav><ul class="td-sidebar-nav__section pe-md-3 ul-0"><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child active-path" id=m-docs-li><a href=../../../../../docs/ class="align-left ps-0 td-sidebar-link td-sidebar-link__section tree-root" id=m-docs><span>Labs</span></a><ul class=ul-1><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child active-path" id=m-docscontainer-basics01-basics-li><a href=../../../../../docs/container-basics/01-basics/ class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id=m-docscontainer-basics01-basics><span>1. Docker Basics</span></a><ul class="ul-2 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docscontainer-basics01-basics01_images-li><a href=../../../../../docs/container-basics/01-basics/01/_images/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-docscontainer-basics01-basics01_images><span>1.1. Images</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docscontainer-basics01-basics01_env-vars-li><a href=../../../../../docs/container-basics/01-basics/01/_env-vars/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-docscontainer-basics01-basics01_env-vars><span>1.2. Environment variables</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docscontainer-basics01-basics01_frontend-li><a href=../../../../../docs/container-basics/01-basics/01/_frontend/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-docscontainer-basics01-basics01_frontend><span>1.3. Frontend</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docscontainer-basics01-basics01_dockerfile-li><a href=../../../../../docs/container-basics/01-basics/01/_dockerfile/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-docscontainer-basics01-basics01_dockerfile><span>1.4. Dockerfile</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child active-path" id=m-docscontainer-basics01-basics01_dockerfile_ms-li><a href=../../../../../docs/container-basics/01-basics/01/_dockerfile_ms/ class="align-left ps-0 active td-sidebar-link td-sidebar-link__page" id=m-docscontainer-basics01-basics01_dockerfile_ms><span class=td-sidebar-nav-active-item>1.5. MultiStage Build</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docscontainer-basics01-basics01_deepdive-li><a href=../../../../../docs/container-basics/01-basics/01/_deepdive/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-docscontainer-basics01-basics01_deepdive><span>1.6. Under the hood</span></a></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-docscontainer-basics02-security-li><a href=../../../../../docs/container-basics/02-security/ class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id=m-docscontainer-basics02-security><span>2. 2. Securing Containers</span></a><ul class="ul-2 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docscontainer-basics02-security02_ssdlc-li><a href=../../../../../docs/container-basics/02-security/02/_ssdlc/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-docscontainer-basics02-security02_ssdlc><span>2.1. SSDLC</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docscontainer-basics02-security02_trust-li><a href=../../../../../docs/container-basics/02-security/02/_trust/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-docscontainer-basics02-security02_trust><span>2.2. Docker Trust</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docscontainer-basics02-security02_root-li><a href=../../../../../docs/container-basics/02-security/02/_root/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-docscontainer-basics02-security02_root><span>2.3. Avoid Root</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docscontainer-basics02-security02_capabilities-li><a href=../../../../../docs/container-basics/02-security/02/_capabilities/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-docscontainer-basics02-security02_capabilities><span>2.4. Capabilities</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docscontainer-basics02-security02_volumes-li><a href=../../../../../docs/container-basics/02-security/02/_volumes/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-docscontainer-basics02-security02_volumes><span>2.5. Volume security</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docscontainer-basics02-security02_lsm-li><a href=../../../../../docs/container-basics/02-security/02/_lsm/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-docscontainer-basics02-security02_lsm><span>2.6. Linux Security Modules</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docscontainer-basics02-security02_runtime_sec-li><a href=../../../../../docs/container-basics/02-security/02/_runtime_sec/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-docscontainer-basics02-security02_runtime_sec><span>2.7. Container Runtime Security</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docscontainer-basics02-security02_privileged-mode-li><a href=../../../../../docs/container-basics/02-security/02/_privileged-mode/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-docscontainer-basics02-security02_privileged-mode><span>2.8. Privileged Containers</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docscontainer-basics02-security02_recap-li><a href=../../../../../docs/container-basics/02-security/02/_recap/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-docscontainer-basics02-security02_recap><span>2.9. Recap</span></a></li></ul></li></ul></li></ul></nav></div></aside><aside class="d-none d-xl-block col-xl-2 td-sidebar-toc d-print-none"><div class="td-page-meta ms-2 pb-1 pt-2 mb-0"><a href=https://github.com/verysonglaa/k8s-security-training-website/tree/main/content/en/docs/container-basics/01-Basics/01/_dockerfile_ms.md class="td-page-meta--view td-page-meta__view" target=_blank rel=noopener><i class="fa-solid fa-file-lines fa-fw"></i> View page source</a>
<a href=https://github.com/verysonglaa/k8s-security-training-website/edit/main/content/en/docs/container-basics/01-Basics/01/_dockerfile_ms.md class="td-page-meta--edit td-page-meta__edit" target=_blank rel=noopener><i class="fa-solid fa-pen-to-square fa-fw"></i> Edit this page</a>
<a href="https://github.com/verysonglaa/k8s-security-training-website/new/main/content/en/docs/container-basics/01-Basics/01?filename=change-me.md&amp;value=---%0Atitle%3A+%22Long+Page+Title%22%0AlinkTitle%3A+%22Short+Nav+Title%22%0Aweight%3A+100%0Adescription%3A+%3E-%0A+++++Page+description+for+heading+and+indexes.%0A---%0A%0A%23%23+Heading%0A%0AEdit+this+template+to+create+your+new+page.%0A%0A%2A+Give+it+a+good+name%2C+ending+in+%60.md%60+-+e.g.+%60getting-started.md%60%0A%2A+Edit+the+%22front+matter%22+section+at+the+top+of+the+page+%28weight+controls+how+its+ordered+amongst+other+pages+in+the+same+directory%3B+lowest+number+first%29.%0A%2A+Add+a+good+commit+message+at+the+bottom+of+the+page+%28%3C80+characters%3B+use+the+extended+description+field+for+more+detail%29.%0A%2A+Create+a+new+branch+so+you+can+preview+your+new+file+and+request+a+review+via+Pull+Request.%0A" class="td-page-meta--child td-page-meta__child" target=_blank rel=noopener><i class="fa-solid fa-pen-to-square fa-fw"></i> Create child page</a>
<a href="https://github.com/verysonglaa/k8s-security-training-website/issues/new?title=MultiStage%20Build" class="td-page-meta--issue td-page-meta__issue" target=_blank rel=noopener><i class="fa-solid fa-list-check fa-fw"></i> Create documentation issue</a></div><div class=td-toc><nav id=TableOfContents><ul><li><a href=#purpose>Purpose</a><ul><li><a href=#java-spring-boot-gradle-build-example>Java Spring Boot Gradle build Example</a></li></ul></li><li><a href=#multi-stage-builds>Multi-stage builds</a></li><li><a href=#create-a-multi-stage-build>Create a multi-stage build</a></li></ul></nav></div></aside><main class="col-12 col-md-9 col-xl-8 ps-md-5" role=main><nav aria-label=breadcrumb class=td-breadcrumbs><ol class=breadcrumb><li class=breadcrumb-item><a href=../../../../../docs/>Labs</a></li><li class=breadcrumb-item><a href=../../../../../docs/container-basics/01-basics/>Docker Basics</a></li><li class="breadcrumb-item active" aria-current=page>MultiStage Build</li></ol></nav><div class=td-content><h1>1.5. MultiStage Build</h1><header class=article-meta></header><p>Often you&rsquo;re going to use some kind of libraries, tools or dependencies during the build phase of your application that are not necessary during the runtime of the container.
To improve security and efficiency we only include whats absolutely necessary in the image. So we often remove these dependencies in the build phase after the application itself has been built.</p><p>In this lab you&rsquo;re going to learn how to use multistage builds and what they are good for.</p><h2 id=purpose>Purpose</h2><p>If the application is not available as a prebuilt artifact, in many cases, the application itself gets built directly during the docker build process <code>docker build -t ...</code></p><h3 id=java-spring-boot-gradle-build-example>Java Spring Boot Gradle build Example</h3><p>The complete example can be found at <a href=https://github.com/appuio/example-spring-boot-helloworld target=_blank rel=noopener>https://github.com/appuio/example-spring-boot-helloworld</a>
.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-Dockerfile data-lang=Dockerfile><span style=display:flex><span><span style=color:#204a87;font-weight:700>FROM</span><span style=color:#4e9a06> registry.access.redhat.com/ubi9/openjdk-17</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#204a87;font-weight:700>LABEL</span> org.opencontainers.image.authors<span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;midcicd@puzzle.ch&#34;</span> <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>      io.k8s.description<span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;APPUiO Example Spring Boot App&#34;</span> <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>      io.k8s.display-name<span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;APPUiO Spring Boot App&#34;</span> <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>      io.openshift.expose-services<span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;8080:http&#34;</span> <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>      io.openshift.tags<span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;springboot&#34;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#204a87;font-weight:700>EXPOSE</span><span style=color:#4e9a06> 8080 9000</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#204a87;font-weight:700>RUN</span> mkdir -p /tmp/src/<span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#204a87;font-weight:700>ADD</span> . /tmp/src/<span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#204a87;font-weight:700>RUN</span> <span style=color:#204a87>cd</span> /tmp/src <span style=color:#ce5c00;font-weight:700>&amp;&amp;</span> sh gradlew build --no-daemon<span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#204a87;font-weight:700>RUN</span> ln -s /tmp/src/build/libs/springboots2idemo*.jar /deployments/springboots2idemo.jar<span style=color:#a40000>
</span></span></span></code></pre></div><p>During the docker build the actual application source code is added to the context and built using the <code>gradlew build</code> command.
Gradle in this case is only used during the build phase since it produces a jar that is then executed with <code>java -jar ...</code> at execution time.</p><p>Build phase dependencies:</p><ul><li>Java</li><li>Gradle</li></ul><p>Runtime phase dependencies:</p><ul><li>Java</li></ul><h2 id=multi-stage-builds>Multi-stage builds</h2><p>With multistage builds you now have the possibility to actually split these two phases, so that you can pass the built artifact from phase one into the runtime phase, without the need to install build time dependencies in the resulting docker image. This means that the image will be smaller and consist of less unneeded dependencies.</p><p>Read more about Docker multi-stage builds at <a href=https://docs.docker.com/develop/develop-images/multistage-build/ target=_blank rel=noopener>https://docs.docker.com/develop/develop-images/multistage-build/</a></p><h2 id=create-a-multi-stage-build>Create a multi-stage build</h2><p>Turn the docker build from the first example (Java Spring boot <a href=https://github.com/appuio/example-spring-boot-helloworld target=_blank rel=noopener>https://github.com/appuio/example-spring-boot-helloworld</a>
) into a docker multistage build.
As a second image you can use <code>registry.access.redhat.com/ubi9/openjdk-17-runtime</code>. Try to find the solution before looking at it.</p><p>Please create two separate images to see the actual size difference as well.</p><details><summary>Show me the solution</summary><p>We start by cloning the repository and building the original image:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#204a87>cd</span> /home/project
</span></span><span style=display:flex><span>git clone https://github.com/appuio/example-spring-boot-helloworld.git
</span></span><span style=display:flex><span><span style=color:#204a87>cd</span> example-spring-boot-helloworld
</span></span><span style=display:flex><span>docker build -t example-spring-boot-helloworld:v0.1 .
</span></span></code></pre></div><p>Now let us build the next version using an optimized Dockerfile, change the content of <code>Dockerfile</code> to the text below:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-Dockerfile data-lang=Dockerfile><span style=display:flex><span><span style=color:#204a87;font-weight:700>FROM</span><span style=color:#4e9a06> registry.access.redhat.com/ubi9/openjdk-17 AS build</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#204a87;font-weight:700>LABEL</span> org.opencontainers.image.authors<span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;noreply@acend.ch&#34;</span> <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>      io.k8s.description<span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;acend example spring boot app&#34;</span> <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>      io.k8s.display-name<span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;acend spring boot app&#34;</span> <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>      io.openshift.expose-services<span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;8080:http&#34;</span> <span style=color:#4e9a06>\
</span></span></span><span style=display:flex><span><span style=color:#4e9a06></span>      io.openshift.tags<span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;springboot&#34;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#204a87;font-weight:700>RUN</span> mkdir -p /tmp/src/<span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#204a87;font-weight:700>ADD</span> . /tmp/src/<span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#204a87;font-weight:700>RUN</span> <span style=color:#204a87>cd</span> /tmp/src <span style=color:#ce5c00;font-weight:700>&amp;&amp;</span> sh gradlew build --no-daemon<span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#204a87;font-weight:700>FROM</span><span style=color:#4e9a06> registry.access.redhat.com/ubi9/openjdk-17-runtime</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#204a87;font-weight:700>EXPOSE</span><span style=color:#4e9a06> 8080 9000</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#204a87;font-weight:700>COPY</span> --from<span style=color:#ce5c00;font-weight:700>=</span>build /tmp/src/build/libs/springboots2idemo*.jar /deployments/springboots2idemo.jar<span style=color:#a40000>
</span></span></span></code></pre></div><p>Now build a new version of the image and compare the size:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>docker build -t example-spring-boot-helloworld:v0.2 .
</span></span><span style=display:flex><span>docker images
</span></span></code></pre></div></details><div class="text-muted mt-5 pt-3"><div class=row><div class=col-sm><a href=../../../../../docs/container-basics/01-basics/01/_dockerfile/ data-toggle=tooltip title=Dockerfile><i class="fa fa-arrow-circle-left"></i> Previous</a></div><div class="col-sm text-right"><a href=../../../../../docs/container-basics/01-basics/01/_deepdive/ data-toggle=tooltip title="Under the hood">Next <i class="fa fa-arrow-circle-right"></i></a></div></div></div><div class=td-page-meta__lastmod>Last modified October 31, 2024: <a href=https://github.com/verysonglaa/k8s-security-training-website/commit/f3c664a9190d4cefc70a6effdc5c00a648a3ec09>typos in basic labs, solutions.txt. for recap optional labs (f3c664a)</a></div></div></main></div></div><footer class="td-footer row d-print-none"><div class=container-fluid><div class="row mx-md-2"><div class="td-footer__left col-6 col-sm-4 order-sm-1"></div><div class="td-footer__right col-6 col-sm-4 order-sm-3"><ul class=td-footer__links-list><li class=td-footer__links-item data-bs-toggle=tooltip title=GitHub aria-label=GitHub><a target=_blank rel=noopener href=https://github.com/verysonglaa/k8s-security-training-website aria-label=GitHub><i class="fab fa-github"></i></a></li></ul></div><div class="td-footer__center col-12 col-sm-4 py-2 order-sm-2"><span class=td-footer__copyright>&copy;
2024
<span class=td-footer__authors>songlaa gmbh</span></span><span class=td-footer__all_rights_reserved>All Rights Reserved</span></div></div></div></footer></div><script src=../../../../../js/main.min.37d14e870feb76f0f7a2a2422bae231efb0186c477999a4ab9ca7e9924ced592.js integrity="sha256-N9FOhw/rdvD3oqJCK64jHvsBhsR3mZpKucp+mSTO1ZI=" crossorigin=anonymous></script><script defer src=../../../../../js/click-to-copy.min.73478a7d4807698aed7e355eb23f9890ca18fea3158604c8471746d046702bad.js integrity="sha256-c0eKfUgHaYrtfjVesj+YkMoY/qMVhgTIRxdG0EZwK60=" crossorigin=anonymous></script><script src=../../../../../js/tabpane-persist.js></script><script src=../../../../../js/site.min.1b86eee028c038e3c091bb0e4a5f11d864071cfddfac37a5b7d7dc4b7af9bd0a.js integrity="sha256-G4bu4CjAOOPAkbsOSl8R2GQHHP3frDelt9fcS3r5vQo=" crossorigin=anonymous></script></body></html>