<!doctype html><html itemscope itemtype=http://schema.org/WebPage lang=en class=no-js><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><link rel="shortcut icon" href=../../../../../favicons/favicon.ico><link rel=apple-touch-icon href=../../../../../favicons/apple-touch-icon-180x180.png sizes=180x180><link rel=icon type=image/png href=../../../../../favicons/favicon-16x16.png sizes=16x16><link rel=icon type=image/png href=../../../../../favicons/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=../../../../../favicons/android-36x36.png sizes=36x36><link rel=icon type=image/png href=../../../../../favicons/android-48x48.png sizes=48x48><link rel=icon type=image/png href=../../../../../favicons/android-72x72.png sizes=72x72><link rel=icon type=image/png href=../../../../../favicons/android-96x96.png sizes=96x96><link rel=icon type=image/png href=../../../../../favicons/android-144x144.png sizes=144x144><link rel=icon type=image/png href=../../../../../favicons/android-192x192.png sizes=192x192><title>2.2 Avoid Root | Kubernetes Security Training</title>
<meta name=description content="Before exploring different options to minimize container privileges, it&amp;rsquo;s important to address a fundamental yet frequently overlooked practice: keeping your software up to date. Regular updates are crucial for protecting against known container escape vulnerabilities, such as Leaky Vessels , which often allow attackers to gain root access to the host. This means both the host system and Docker itself must be consistently updated, including the host kernel and Docker Engine."><meta property="og:title" content="2.2 Avoid Root"><meta property="og:description" content="Before exploring different options to minimize container privileges, it&rsquo;s important to address a fundamental yet frequently overlooked practice: keeping your software up to date. Regular updates are crucial for protecting against known container escape vulnerabilities, such as Leaky Vessels , which often allow attackers to gain root access to the host. This means both the host system and Docker itself must be consistently updated, including the host kernel and Docker Engine."><meta property="og:type" content="article"><meta property="og:url" content="/docs/container-basics/02-security/02/_root/"><meta property="article:section" content="docs"><meta property="article:modified_time" content="2024-09-16T16:24:16+02:00"><meta itemprop=name content="2.2 Avoid Root"><meta itemprop=description content="Before exploring different options to minimize container privileges, it&rsquo;s important to address a fundamental yet frequently overlooked practice: keeping your software up to date. Regular updates are crucial for protecting against known container escape vulnerabilities, such as Leaky Vessels , which often allow attackers to gain root access to the host. This means both the host system and Docker itself must be consistently updated, including the host kernel and Docker Engine."><meta itemprop=dateModified content="2024-09-16T16:24:16+02:00"><meta itemprop=wordCount content="885"><meta itemprop=keywords content><meta name=twitter:card content="summary"><meta name=twitter:title content="2.2 Avoid Root"><meta name=twitter:description content="Before exploring different options to minimize container privileges, it&rsquo;s important to address a fundamental yet frequently overlooked practice: keeping your software up to date. Regular updates are crucial for protecting against known container escape vulnerabilities, such as Leaky Vessels , which often allow attackers to gain root access to the host. This means both the host system and Docker itself must be consistently updated, including the host kernel and Docker Engine."><link rel=preload href=../../../../../scss/main.min.5118d334f4d49e78b43432d75232dda13144ff70fc9d784048f9c31c8751ea0f.css as=style><link href=../../../../../scss/main.min.5118d334f4d49e78b43432d75232dda13144ff70fc9d784048f9c31c8751ea0f.css rel=stylesheet integrity><script src=https://code.jquery.com/jquery-3.7.1.min.js integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin=anonymous></script><script defer src=https://unpkg.com/lunr@2.3.9/lunr.min.js integrity=sha384-203J0SNzyqHby3iU6hzvzltrWi/M41wOP5Gu+BiJMz5nwKykbkUx8Kp7iti0Lpli crossorigin=anonymous></script></head><body class=td-page><header><nav class="td-navbar js-navbar-scroll" data-bs-theme=dark><div class="container-fluid flex-column flex-md-row"><a class=navbar-brand href=../../../../../><span class="navbar-brand__logo navbar-logo"><svg version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
	 viewBox="0 0 500 500" style="enable-background:new 0 0 500 500;" xml:space="preserve">
<g>
	<path style="fill:#FFFFFF;" d="M116.8525,421.9722c-5.7041,0-10.3442-4.3127-10.3442-9.6129V88.183
		c0-5.3002,4.6401-9.6117,10.3442-9.6117H320.858c3.0347,0,9.3959,0.5498,11.7506,2.6302l0.3545,0.3442l58.905,63.2912
		c2.3101,2.491,2.9202,8.4928,2.9202,11.3184v256.2039c0,5.3002-4.6407,9.6129-10.3436,9.6129H116.8525z"/>
	<g>
		<g>
			<g>
				<path style="fill:#767676;" d="M384.4445,423.2066H116.852c-6.3839,0-11.5786-4.8658-11.5786-10.8474V88.1831
					c0-5.9804,5.1947-10.8461,11.5786-10.8461h204.0062c0.377,0,9.2786,0.0329,12.568,2.9389l0.3947,0.3833l58.9508,63.337
					c3.2135,3.4652,3.2514,11.7924,3.2514,12.1593v256.2036C396.0231,418.3408,390.8284,423.2066,384.4445,423.2066z
					 M116.5079,411.9189c0.0848,0.0278,0.1999,0.0531,0.3441,0.0531h267.5925c0.1442,0,0.2581-0.0253,0.3441-0.0531V156.1556
					c-0.0076-0.9033-0.3593-3.7347-0.7034-5.0037l-57.6527-61.9416c-1.4651-0.3176-4.4533-0.6389-5.5742-0.6389H116.852
					c-0.143,0-0.2594,0.024-0.3441,0.0531V411.9189z M383.9612,150.7699L383.9612,150.7699L383.9612,150.7699z M327.0321,89.371
					v0.0013V89.371z"/>
			</g>
		</g>
	</g>
	<g>
		<g>
			<path style="fill:#5B7FC0;" d="M189.0874,210.1754l0.0012-0.0012c7.7751,0.0012,15.0295,4.1862,18.932,10.9234
				c1.9177,3.3159,2.9305,7.1011,2.9293,10.9378c0,5.8394-2.2733,11.3304-6.4032,15.4604
				c-4.1288,4.1288-9.6186,6.4032-15.458,6.4032c-5.8394,0-11.328-2.2733-15.458-6.4032s-6.4032-9.6186-6.4056-15.4628
				c0.0012-6.025,2.454-11.4897,6.4116-15.4473C177.5953,212.627,183.0601,210.1742,189.0874,210.1754z M197.0804,232.033
				c0.0012-1.4042-0.3687-2.7868-1.063-3.9887c-1.4293-2.4684-4.0833-3.9995-6.9299-4.0019c-4.4077,0.0024-7.993,3.5877-7.993,7.993
				c0,2.1356,0.832,4.1431,2.3427,5.6539c1.5083,1.5083,3.5159,2.3403,5.6503,2.3415c2.1356,0,4.1443-0.8308,5.6539-2.3403
				S197.0816,234.1722,197.0804,232.033z"/>
			<path style="opacity:0.3;fill:#FFFFFF;" d="M189.0898,210.176c7.7763,0,15.0283,4.1826,18.926,10.9151
				c1.9201,3.3136,2.9377,7.0988,2.9353,10.9462c0.0024,12.0643-9.8065,21.8636-21.8613,21.8613
				c-12.0547,0.0024-21.8636-9.8066-21.8612-21.8613c0-6.0285,2.4516-11.4921,6.4116-15.452
				C177.5977,212.6276,183.0612,210.176,189.0898,210.176z M197.0839,232.0372c0-1.4078-0.3711-2.7892-1.0702-3.9959
				c-1.4269-2.466-4.0797-3.9983-6.924-3.9983c-4.4005-0.0048-7.9918,3.5817-7.9942,7.9942
				c0.0024,4.4077,3.5865,7.9918,7.9942,7.9942c2.2027,0,4.2018-0.8978,5.6479-2.3439
				C196.1861,236.239,197.0839,234.2399,197.0839,232.0372z"/>
			<g>
				<defs>
					<path id="SVGID_1_" d="M194.7376,237.6875c-1.4461,1.4461-3.4452,2.3439-5.6479,2.3439
						c-4.4077-0.0024-7.9918-3.5865-7.9942-7.9942c0.0024-4.4125,3.5937-7.999,7.9942-7.9942c2.8443,0,5.497,1.5323,6.924,3.9983
						c0.6991,1.2067,1.0702,2.5881,1.0702,3.9959C197.0839,234.2399,196.1861,236.239,194.7376,237.6875z"/>
				</defs>
				<clipPath id="SVGID_2_">
					<use xlink:href="#SVGID_1_"  style="overflow:visible;"/>
				</clipPath>
				<path style="clip-path:url(#SVGID_2_);fill:#FFFFFF;" d="M190.0704,225.0237c-4.4005-0.0048-7.9918,3.5817-7.9942,7.9942
					c0.0011,1.9546,0.7088,3.7452,1.8782,5.1354c-1.7447-1.4674-2.8575-3.663-2.8588-6.116
					c0.0024-4.4125,3.5936-7.999,7.9942-7.9942c2.3802-0.0001,4.616,1.0833,6.1218,2.8788
					C193.7885,225.7247,191.9774,225.0237,190.0704,225.0237z"/>
				<path style="opacity:0.13;clip-path:url(#SVGID_2_);fill:#020202;" d="M190.0704,225.0237
					c-4.4005-0.0048-7.9918,3.5817-7.9942,7.9942c0.0011,1.9546,0.7088,3.7452,1.8782,5.1354
					c-1.7447-1.4674-2.8575-3.663-2.8588-6.116c0.0024-4.4125,3.5936-7.999,7.9942-7.9942c2.3802-0.0001,4.616,1.0833,6.1218,2.8788
					C193.7885,225.7247,191.9774,225.0237,190.0704,225.0237z"/>
			</g>
			<g>
				<defs>
					<path id="SVGID_3_" d="M189.0898,210.176c7.7763,0,15.0283,4.1826,18.926,10.9151c1.9201,3.3136,2.9377,7.0988,2.9353,10.9462
						c0.0024,12.0643-9.8065,21.8636-21.8613,21.8613c-12.0547,0.0024-21.8636-9.8066-21.8612-21.8613
						c0-6.0285,2.4516-11.4921,6.4116-15.452C177.5977,212.6276,183.0612,210.176,189.0898,210.176z M197.0839,232.0372
						c0-1.4078-0.3711-2.7892-1.0702-3.9959c-1.4269-2.466-4.0797-3.9983-6.924-3.9983c-4.4005-0.0048-7.9918,3.5817-7.9942,7.9942
						c0.0024,4.4077,3.5865,7.9918,7.9942,7.9942c2.2027,0,4.2018-0.8978,5.6479-2.3439
						C196.1861,236.239,197.0839,234.2399,197.0839,232.0372z"/>
				</defs>
				<clipPath id="SVGID_4_">
					<use xlink:href="#SVGID_3_"  style="overflow:visible;"/>
				</clipPath>
				<path style="clip-path:url(#SVGID_4_);fill:#5B7FC0;" d="M172.6595,215.6045c-3.96,3.96-6.4116,9.4235-6.4116,15.452
					c-0.0024,12.0547,9.8066,21.8636,21.8613,21.8612c12.0547,0.0024,21.8636-9.797,21.8613-21.8612
					c0.0024-3.8475-1.0151-7.6326-2.9353-10.9462c-3.8977-6.7324-11.1497-10.9151-18.926-10.9151
					C182.0806,209.1953,176.6171,211.647,172.6595,215.6045z"/>
			</g>
		</g>
		<rect x="198.8952" y="225.1043" style="fill:#5B7FC0;" width="122.6266" height="13.8671"/>
	</g>
	<g>
		<path style="fill:#D95140;" d="M189.0874,155.7611l0.0012-0.0012c7.7751,0.0012,15.0295,4.1862,18.932,10.9234
			c1.9177,3.3159,2.9305,7.1011,2.9293,10.9378c0,5.8394-2.2733,11.3304-6.4032,15.4604c-4.1288,4.1288-9.6186,6.4032-15.458,6.4032
			c-5.8394,0-11.328-2.2733-15.458-6.4032s-6.4032-9.6186-6.4056-15.4628c0.0012-6.0249,2.454-11.4897,6.4116-15.4473
			C177.5953,158.2128,183.0601,155.7599,189.0874,155.7611z M197.0804,177.6188c0.0012-1.4042-0.3687-2.7868-1.063-3.9887
			c-1.4293-2.4684-4.0833-3.9995-6.9299-4.0019c-4.4077,0.0024-7.993,3.5877-7.993,7.993c0,2.1356,0.832,4.1431,2.3427,5.6539
			c1.5083,1.5083,3.5159,2.3403,5.6503,2.3415c2.1356,0,4.1443-0.8308,5.6539-2.3403
			C196.2508,181.7667,197.0816,179.758,197.0804,177.6188z"/>
		<path style="opacity:0.3;fill:#FFFFFF;" d="M189.0898,155.7617c7.7763,0,15.0283,4.1826,18.926,10.9151
			c1.9201,3.3135,2.9377,7.0987,2.9353,10.9462c0.0024,12.0643-9.8065,21.8636-21.8613,21.8613
			c-12.0547,0.0024-21.8636-9.8066-21.8612-21.8613c0-6.0285,2.4516-11.4921,6.4116-15.452
			C177.5977,158.2134,183.0612,155.7617,189.0898,155.7617z M197.0839,177.623c0-1.4078-0.3711-2.7892-1.0702-3.9959
			c-1.4269-2.466-4.0797-3.9983-6.924-3.9983c-4.4005-0.0048-7.9918,3.5817-7.9942,7.9942
			c0.0024,4.4077,3.5865,7.9918,7.9942,7.9942c2.2027,0,4.2018-0.8978,5.6479-2.3439
			C196.1861,181.8248,197.0839,179.8256,197.0839,177.623z"/>
		<g>
			<defs>
				<path id="SVGID_5_" d="M194.7376,183.2733c-1.4461,1.4461-3.4452,2.3439-5.6479,2.3439
					c-4.4077-0.0024-7.9918-3.5865-7.9942-7.9942c0.0024-4.4125,3.5937-7.9989,7.9942-7.9942c2.8443,0,5.497,1.5323,6.924,3.9983
					c0.6991,1.2067,1.0702,2.5881,1.0702,3.9959C197.0839,179.8256,196.1861,181.8248,194.7376,183.2733z"/>
			</defs>
			<clipPath id="SVGID_6_">
				<use xlink:href="#SVGID_5_"  style="overflow:visible;"/>
			</clipPath>
			<path style="clip-path:url(#SVGID_6_);fill:#FFFFFF;" d="M190.0704,170.6095c-4.4005-0.0048-7.9918,3.5817-7.9942,7.9942
				c0.0011,1.9546,0.7088,3.7452,1.8782,5.1354c-1.7447-1.4674-2.8575-3.663-2.8588-6.116c0.0024-4.4125,3.5936-7.999,7.9942-7.9942
				c2.3802-0.0001,4.616,1.0833,6.1218,2.8788C193.7885,171.3104,191.9774,170.6095,190.0704,170.6095z"/>
			<path style="opacity:0.13;clip-path:url(#SVGID_6_);fill:#020202;" d="M190.0704,170.6095
				c-4.4005-0.0048-7.9918,3.5817-7.9942,7.9942c0.0011,1.9546,0.7088,3.7452,1.8782,5.1354
				c-1.7447-1.4674-2.8575-3.663-2.8588-6.116c0.0024-4.4125,3.5936-7.999,7.9942-7.9942c2.3802-0.0001,4.616,1.0833,6.1218,2.8788
				C193.7885,171.3104,191.9774,170.6095,190.0704,170.6095z"/>
		</g>
		<g>
			<defs>
				<path id="SVGID_7_" d="M189.0898,155.7617c7.7763,0,15.0283,4.1826,18.926,10.9151c1.9201,3.3135,2.9377,7.0987,2.9353,10.9462
					c0.0024,12.0643-9.8065,21.8636-21.8613,21.8613c-12.0547,0.0024-21.8636-9.8066-21.8612-21.8613
					c0-6.0285,2.4516-11.4921,6.4116-15.452C177.5977,158.2134,183.0612,155.7617,189.0898,155.7617z M197.0839,177.623
					c0-1.4078-0.3711-2.7892-1.0702-3.9959c-1.4269-2.466-4.0797-3.9983-6.924-3.9983c-4.4005-0.0048-7.9918,3.5817-7.9942,7.9942
					c0.0024,4.4077,3.5865,7.9918,7.9942,7.9942c2.2027,0,4.2018-0.8978,5.6479-2.3439
					C196.1861,181.8248,197.0839,179.8256,197.0839,177.623z"/>
			</defs>
			<clipPath id="SVGID_8_">
				<use xlink:href="#SVGID_7_"  style="overflow:visible;"/>
			</clipPath>
			<path style="clip-path:url(#SVGID_8_);fill:#D95140;" d="M172.6595,161.1903c-3.96,3.96-6.4116,9.4235-6.4116,15.452
				c-0.0024,12.0547,9.8066,21.8636,21.8613,21.8613c12.0547,0.0024,21.8636-9.797,21.8613-21.8613
				c0.0024-3.8474-1.0151-7.6326-2.9353-10.9462c-3.8977-6.7324-11.1497-10.9151-18.926-10.9151
				C182.0806,154.7811,176.6171,157.2327,172.6595,161.1903z"/>
		</g>
		<rect x="198.8952" y="170.69" style="fill:#D95140;" width="122.6266" height="13.8671"/>
	</g>
	<g>
		<g>
			<path style="fill:#56A55C;" d="M189.5379,264.6147l0.0012-0.0012c7.7751,0.0012,15.0294,4.1862,18.932,10.9235
				c1.9177,3.3159,2.9305,7.1011,2.9293,10.9378c0,5.8394-2.2733,11.3304-6.4032,15.4604
				c-4.1288,4.1288-9.6186,6.4032-15.458,6.4032c-5.8394,0-11.3281-2.2733-15.458-6.4032c-4.13-4.13-6.4032-9.6186-6.4056-15.4628
				c0.0012-6.0249,2.454-11.4897,6.4116-15.4472C178.0458,267.0663,183.5105,264.6135,189.5379,264.6147z M197.5309,286.4723
				c0.0012-1.4042-0.3687-2.7868-1.063-3.9887c-1.4293-2.4684-4.0833-3.9995-6.9299-4.0019c-4.4077,0.0024-7.993,3.5877-7.993,7.993
				c0,2.1356,0.832,4.1431,2.3427,5.6538c1.5083,1.5083,3.5159,2.3403,5.6503,2.3415c2.1356,0,4.1443-0.8308,5.6539-2.3403
				C196.7013,290.6202,197.5321,288.6115,197.5309,286.4723z"/>
			<path style="opacity:0.3;fill:#FFFFFF;" d="M189.5403,264.6153c7.7763,0,15.0283,4.1826,18.926,10.9151
				c1.9201,3.3135,2.9377,7.0987,2.9353,10.9462c0.0024,12.0643-9.8065,21.8636-21.8613,21.8613
				c-12.0547,0.0024-21.8636-9.8065-21.8612-21.8613c0-6.0285,2.4516-11.492,6.4116-15.452
				C178.0482,267.0669,183.5117,264.6153,189.5403,264.6153z M197.5344,286.4765c0-1.4078-0.3711-2.7892-1.0702-3.9959
				c-1.4269-2.466-4.0797-3.9983-6.924-3.9983c-4.4005-0.0048-7.9918,3.5817-7.9942,7.9941
				c0.0024,4.4077,3.5865,7.9918,7.9942,7.9942c2.2027,0,4.2018-0.8978,5.6479-2.3439
				C196.6366,290.6783,197.5344,288.6792,197.5344,286.4765z"/>
			<g>
				<defs>
					<path id="SVGID_9_" d="M195.1881,292.1268c-1.4461,1.4461-3.4452,2.3439-5.6479,2.3439
						c-4.4077-0.0024-7.9918-3.5865-7.9942-7.9942c0.0024-4.4125,3.5937-7.9989,7.9942-7.9941c2.8443,0,5.497,1.5323,6.924,3.9983
						c0.6991,1.2067,1.0702,2.5881,1.0702,3.9959C197.5344,288.6792,196.6366,290.6783,195.1881,292.1268z"/>
				</defs>
				<clipPath id="SVGID_10_">
					<use xlink:href="#SVGID_9_"  style="overflow:visible;"/>
				</clipPath>
				<path style="clip-path:url(#SVGID_10_);fill:#FFFFFF;" d="M190.5209,279.463c-4.4005-0.0048-7.9918,3.5817-7.9942,7.9941
					c0.0011,1.9547,0.7088,3.7452,1.8782,5.1354c-1.7446-1.4674-2.8575-3.6631-2.8588-6.1161
					c0.0024-4.4125,3.5936-7.999,7.9942-7.9941c2.3802-0.0001,4.616,1.0833,6.1218,2.8788
					C194.239,280.164,192.4279,279.463,190.5209,279.463z"/>
				<path style="opacity:0.13;clip-path:url(#SVGID_10_);fill:#020202;" d="M190.5209,279.463
					c-4.4005-0.0048-7.9918,3.5817-7.9942,7.9941c0.0011,1.9547,0.7088,3.7452,1.8782,5.1354
					c-1.7446-1.4674-2.8575-3.6631-2.8588-6.1161c0.0024-4.4125,3.5936-7.999,7.9942-7.9941
					c2.3802-0.0001,4.616,1.0833,6.1218,2.8788C194.239,280.164,192.4279,279.463,190.5209,279.463z"/>
			</g>
			<g>
				<defs>
					<path id="SVGID_11_" d="M189.5403,264.6153c7.7763,0,15.0283,4.1826,18.926,10.9151
						c1.9201,3.3135,2.9377,7.0987,2.9353,10.9462c0.0024,12.0643-9.8065,21.8636-21.8613,21.8613
						c-12.0547,0.0024-21.8636-9.8065-21.8612-21.8613c0-6.0285,2.4516-11.492,6.4116-15.452
						C178.0482,267.0669,183.5117,264.6153,189.5403,264.6153z M197.5344,286.4765c0-1.4078-0.3711-2.7892-1.0702-3.9959
						c-1.4269-2.466-4.0797-3.9983-6.924-3.9983c-4.4005-0.0048-7.9918,3.5817-7.9942,7.9941
						c0.0024,4.4077,3.5865,7.9918,7.9942,7.9942c2.2027,0,4.2018-0.8978,5.6479-2.3439
						C196.6366,290.6783,197.5344,288.6792,197.5344,286.4765z"/>
				</defs>
				<clipPath id="SVGID_12_">
					<use xlink:href="#SVGID_11_"  style="overflow:visible;"/>
				</clipPath>
				<path style="clip-path:url(#SVGID_12_);fill:#56A55C;" d="M173.11,270.0439c-3.96,3.96-6.4116,9.4235-6.4116,15.452
					c-0.0024,12.0547,9.8066,21.8636,21.8613,21.8613c12.0547,0.0024,21.8636-9.797,21.8613-21.8613
					c0.0024-3.8474-1.0151-7.6326-2.9353-10.9462c-3.8977-6.7325-11.1497-10.9151-18.926-10.9151
					C182.5311,263.6346,177.0676,266.0863,173.11,270.0439z"/>
			</g>
		</g>
		<rect x="199.3456" y="279.5436" style="fill:#56A55C;" width="122.6266" height="13.8671"/>
	</g>
	<g>
		<g>
			<path style="fill:#F1BC42;" d="M189.0874,318.7208l0.0012-0.0012c7.7751,0.0012,15.0295,4.1862,18.932,10.9234
				c1.9177,3.3159,2.9305,7.1011,2.9293,10.9378c0,5.8394-2.2733,11.3305-6.4032,15.4604
				c-4.1288,4.1288-9.6186,6.4032-15.458,6.4032c-5.8394,0-11.328-2.2733-15.458-6.4032c-4.13-4.1299-6.4032-9.6186-6.4056-15.4628
				c0.0012-6.025,2.454-11.4897,6.4116-15.4472C177.5953,321.1724,183.0601,318.7196,189.0874,318.7208z M197.0804,340.5784
				c0.0012-1.4042-0.3687-2.7868-1.063-3.9887c-1.4293-2.4684-4.0833-3.9995-6.9299-4.0019c-4.4077,0.0024-7.993,3.5877-7.993,7.993
				c0,2.1356,0.832,4.1431,2.3427,5.6539c1.5083,1.5083,3.5159,2.3403,5.6503,2.3415c2.1356,0,4.1443-0.8308,5.6539-2.3403
				S197.0816,342.7176,197.0804,340.5784z"/>
			<path style="opacity:0.3;fill:#FFFFFF;" d="M189.0898,318.7214c7.7763,0,15.0283,4.1826,18.926,10.915
				c1.9201,3.3136,2.9377,7.0988,2.9353,10.9462c0.0024,12.0643-9.8065,21.8636-21.8613,21.8612
				c-12.0547,0.0024-21.8636-9.8065-21.8612-21.8612c0-6.0285,2.4516-11.4921,6.4116-15.452
				C177.5977,321.173,183.0612,318.7214,189.0898,318.7214z M197.0839,340.5826c0-1.4078-0.3711-2.7892-1.0702-3.9959
				c-1.4269-2.466-4.0797-3.9983-6.924-3.9983c-4.4005-0.0048-7.9918,3.5817-7.9942,7.9942
				c0.0024,4.4077,3.5865,7.9918,7.9942,7.9942c2.2027,0,4.2018-0.8978,5.6479-2.3439
				C196.1861,344.7844,197.0839,342.7853,197.0839,340.5826z"/>
			<g>
				<defs>
					<path id="SVGID_13_" d="M194.7376,346.2329c-1.4461,1.4461-3.4452,2.3439-5.6479,2.3439
						c-4.4077-0.0024-7.9918-3.5865-7.9942-7.9942c0.0024-4.4125,3.5937-7.999,7.9942-7.9942c2.8443,0,5.497,1.5323,6.924,3.9983
						c0.6991,1.2067,1.0702,2.5881,1.0702,3.9959C197.0839,342.7853,196.1861,344.7844,194.7376,346.2329z"/>
				</defs>
				<clipPath id="SVGID_14_">
					<use xlink:href="#SVGID_13_"  style="overflow:visible;"/>
				</clipPath>
				<path style="clip-path:url(#SVGID_14_);fill:#FFFFFF;" d="M190.0704,333.5691c-4.4005-0.0048-7.9918,3.5817-7.9942,7.9942
					c0.0011,1.9547,0.7088,3.7452,1.8782,5.1354c-1.7447-1.4674-2.8575-3.6631-2.8588-6.1161
					c0.0024-4.4125,3.5936-7.999,7.9942-7.9942c2.3802-0.0001,4.616,1.0834,6.1218,2.8788
					C193.7885,334.2701,191.9774,333.5691,190.0704,333.5691z"/>
				<path style="opacity:0.13;clip-path:url(#SVGID_14_);fill:#020202;" d="M190.0704,333.5691
					c-4.4005-0.0048-7.9918,3.5817-7.9942,7.9942c0.0011,1.9547,0.7088,3.7452,1.8782,5.1354
					c-1.7447-1.4674-2.8575-3.6631-2.8588-6.1161c0.0024-4.4125,3.5936-7.999,7.9942-7.9942
					c2.3802-0.0001,4.616,1.0834,6.1218,2.8788C193.7885,334.2701,191.9774,333.5691,190.0704,333.5691z"/>
			</g>
			<g>
				<defs>
					<path id="SVGID_15_" d="M189.0898,318.7214c7.7763,0,15.0283,4.1826,18.926,10.915c1.9201,3.3136,2.9377,7.0988,2.9353,10.9462
						c0.0024,12.0643-9.8065,21.8636-21.8613,21.8612c-12.0547,0.0024-21.8636-9.8065-21.8612-21.8612
						c0-6.0285,2.4516-11.4921,6.4116-15.452C177.5977,321.173,183.0612,318.7214,189.0898,318.7214z M197.0839,340.5826
						c0-1.4078-0.3711-2.7892-1.0702-3.9959c-1.4269-2.466-4.0797-3.9983-6.924-3.9983c-4.4005-0.0048-7.9918,3.5817-7.9942,7.9942
						c0.0024,4.4077,3.5865,7.9918,7.9942,7.9942c2.2027,0,4.2018-0.8978,5.6479-2.3439
						C196.1861,344.7844,197.0839,342.7853,197.0839,340.5826z"/>
				</defs>
				<clipPath id="SVGID_16_">
					<use xlink:href="#SVGID_15_"  style="overflow:visible;"/>
				</clipPath>
				<path style="clip-path:url(#SVGID_16_);fill:#F1BC42;" d="M172.6595,324.15c-3.96,3.96-6.4116,9.4235-6.4116,15.452
					c-0.0024,12.0547,9.8066,21.8636,21.8613,21.8612c12.0547,0.0024,21.8636-9.797,21.8613-21.8612
					c0.0024-3.8474-1.0151-7.6327-2.9353-10.9462c-3.8977-6.7324-11.1497-10.9151-18.926-10.9151
					C182.0806,317.7407,176.6171,320.1924,172.6595,324.15z"/>
			</g>
		</g>
		<rect x="198.8952" y="333.6497" style="fill:#F1BC42;" width="122.6266" height="13.8671"/>
	</g>
</g>
</svg>
</span><span class=navbar-brand__name>Kubernetes Security Training</span></a><div class="td-navbar-nav-scroll ms-md-auto" id=main_navbar><ul class=navbar-nav><li class=nav-item><a class=nav-link href=../../../../../setup/><span>Setup</span></a></li><li class=nav-item><a class="nav-link active" href=../../../../../docs/><span>Labs</span></a></li><li class=nav-item><a class=nav-link href=../../../../../slides/><span>Slides</span></a></li><li class=nav-item><a class=nav-link href=https://www.songlaa.ch target=_blank rel=noopener><span>songlaa gmbh</span></a></li></ul></div><div class="d-none d-lg-block"><div class="td-search td-search--offline"><div class=td-search__icon></div><input type=search class="td-search__input form-control" placeholder="Search this site…" aria-label="Search this site…" autocomplete=off data-offline-search-index-json-src=../../../../../offline-search-index.343709b5942b23182eaa51ac9a5054d2.json data-offline-search-base-href=../../../../../ data-offline-search-max-results=10></div></div></div></nav></header><div class="container-fluid td-outer"><div class=td-main><div class="row flex-xl-nowrap"><aside class="col-12 col-md-3 col-xl-2 td-sidebar d-print-none"><div id=td-sidebar-menu class=td-sidebar__inner><form class="td-sidebar__search d-flex align-items-center"><div class="td-search td-search--offline"><div class=td-search__icon></div><input type=search class="td-search__input form-control" placeholder="Search this site…" aria-label="Search this site…" autocomplete=off data-offline-search-index-json-src=../../../../../offline-search-index.343709b5942b23182eaa51ac9a5054d2.json data-offline-search-base-href=../../../../../ data-offline-search-max-results=10></div><button class="btn btn-link td-sidebar__toggle d-md-none p-0 ms-3 fas fa-bars" type=button data-bs-toggle=collapse data-bs-target=#td-section-nav aria-controls=td-section-nav aria-expanded=false aria-label="Toggle section navigation"></button></form><nav class="td-sidebar-nav collapse" id=td-section-nav><ul class="td-sidebar-nav__section pe-md-3 ul-0"><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child active-path" id=m-docs-li><a href=../../../../../docs/ class="align-left ps-0 td-sidebar-link td-sidebar-link__section tree-root" id=m-docs><span>Labs</span></a><ul class=ul-1><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-docscontainer-basics01-basics-li><a href=../../../../../docs/container-basics/01-basics/ class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id=m-docscontainer-basics01-basics><span>1. Docker Basics</span></a><ul class="ul-2 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docscontainer-basics01-basics01_images-li><a href=../../../../../docs/container-basics/01-basics/01/_images/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-docscontainer-basics01-basics01_images><span>1.1 Images</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docscontainer-basics01-basics01_env-vars-li><a href=../../../../../docs/container-basics/01-basics/01/_env-vars/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-docscontainer-basics01-basics01_env-vars><span>1.2 Environment variables</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docscontainer-basics01-basics01_frontend-li><a href=../../../../../docs/container-basics/01-basics/01/_frontend/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-docscontainer-basics01-basics01_frontend><span>1.3 Frontend</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docscontainer-basics01-basics01_dockerfile-li><a href=../../../../../docs/container-basics/01-basics/01/_dockerfile/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-docscontainer-basics01-basics01_dockerfile><span>1.4 Dockerfile</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docscontainer-basics01-basics01_dockerfile_ms-li><a href=../../../../../docs/container-basics/01-basics/01/_dockerfile_ms/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-docscontainer-basics01-basics01_dockerfile_ms><span>1.5 MultiStage Build</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docscontainer-basics01-basics01_deepdive-li><a href=../../../../../docs/container-basics/01-basics/01/_deepdive/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-docscontainer-basics01-basics01_deepdive><span>1.6 Under the hood</span></a></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child active-path" id=m-docscontainer-basics02-security-li><a href=../../../../../docs/container-basics/02-security/ class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id=m-docscontainer-basics02-security><span>2. Securing Containers</span></a><ul class="ul-2 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docscontainer-basics02-security02_ssdlc-li><a href=../../../../../docs/container-basics/02-security/02/_ssdlc/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-docscontainer-basics02-security02_ssdlc><span>2.1 SSDLC</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child active-path" id=m-docscontainer-basics02-security02_root-li><a href=../../../../../docs/container-basics/02-security/02/_root/ class="align-left ps-0 active td-sidebar-link td-sidebar-link__page" id=m-docscontainer-basics02-security02_root><span class=td-sidebar-nav-active-item>2.2 Avoid Root</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docscontainer-basics02-security02_capabilities-li><a href=../../../../../docs/container-basics/02-security/02/_capabilities/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-docscontainer-basics02-security02_capabilities><span>2.3 Capabilities</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docscontainer-basics02-security02_volumes-li><a href=../../../../../docs/container-basics/02-security/02/_volumes/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-docscontainer-basics02-security02_volumes><span>2.4 Volume security</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docscontainer-basics02-security02_lsm-li><a href=../../../../../docs/container-basics/02-security/02/_lsm/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-docscontainer-basics02-security02_lsm><span>2.6 Linux Security Modules</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docscontainer-basics02-security02_privileged-mode-li><a href=../../../../../docs/container-basics/02-security/02/_privileged-mode/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-docscontainer-basics02-security02_privileged-mode><span>2.7 Privileged Containers</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docscontainer-basics02-security02_runtime_sec-li><a href=../../../../../docs/container-basics/02-security/02/_runtime_sec/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-docscontainer-basics02-security02_runtime_sec><span>2.8 Container Runtime Security</span></a></li></ul></li></ul></li></ul></nav></div></aside><aside class="d-none d-xl-block col-xl-2 td-sidebar-toc d-print-none"><div class="td-page-meta ms-2 pb-1 pt-2 mb-0"><a href=https://github.com/verysonglaa/k8s-security-training-website/tree/main/content/en/docs/container-basics/02-Security/02/_root.md class="td-page-meta--view td-page-meta__view" target=_blank rel=noopener><i class="fa-solid fa-file-lines fa-fw"></i> View page source</a>
<a href=https://github.com/verysonglaa/k8s-security-training-website/edit/main/content/en/docs/container-basics/02-Security/02/_root.md class="td-page-meta--edit td-page-meta__edit" target=_blank rel=noopener><i class="fa-solid fa-pen-to-square fa-fw"></i> Edit this page</a>
<a href="https://github.com/verysonglaa/k8s-security-training-website/new/main/content/en/docs/container-basics/02-Security/02?filename=change-me.md&amp;value=---%0Atitle%3A+%22Long+Page+Title%22%0AlinkTitle%3A+%22Short+Nav+Title%22%0Aweight%3A+100%0Adescription%3A+%3E-%0A+++++Page+description+for+heading+and+indexes.%0A---%0A%0A%23%23+Heading%0A%0AEdit+this+template+to+create+your+new+page.%0A%0A%2A+Give+it+a+good+name%2C+ending+in+%60.md%60+-+e.g.+%60getting-started.md%60%0A%2A+Edit+the+%22front+matter%22+section+at+the+top+of+the+page+%28weight+controls+how+its+ordered+amongst+other+pages+in+the+same+directory%3B+lowest+number+first%29.%0A%2A+Add+a+good+commit+message+at+the+bottom+of+the+page+%28%3C80+characters%3B+use+the+extended+description+field+for+more+detail%29.%0A%2A+Create+a+new+branch+so+you+can+preview+your+new+file+and+request+a+review+via+Pull+Request.%0A" class="td-page-meta--child td-page-meta__child" target=_blank rel=noopener><i class="fa-solid fa-pen-to-square fa-fw"></i> Create child page</a>
<a href="https://github.com/verysonglaa/k8s-security-training-website/issues/new?title=2.2%20Avoid%20Root" class="td-page-meta--issue td-page-meta__issue" target=_blank rel=noopener><i class="fa-solid fa-list-check fa-fw"></i> Create documentation issue</a></div><div class=td-toc><nav id=TableOfContents><ul><li><a href=#user-management-in-docker>User Management in Docker</a><ul><li><a href=#run-as-different-user>Run as different user</a></li><li><a href=#add-user-to-dockerfile>Add USER to Dockerfile</a></li><li><a href=#configure-the-docker-daemon-to-user-user-namespaces>Configure the Docker Daemon to user USER namespaces</a></li></ul></li><li><a href=#why-to-avoid-running-as-root>Why to avoid running as root</a></li></ul></nav></div></aside><main class="col-12 col-md-9 col-xl-8 ps-md-5" role=main><nav aria-label=breadcrumb class=td-breadcrumbs><ol class=breadcrumb><li class=breadcrumb-item><a href=../../../../../docs/>Labs</a></li><li class=breadcrumb-item><a href=../../../../../docs/container-basics/02-security/>2. Securing Containers</a></li><li class="breadcrumb-item active" aria-current=page>2.2 Avoid Root</li></ol></nav><div class=td-content><h1>2.2 Avoid Root</h1><header class=article-meta></header><p>Before exploring different options to minimize container privileges, it&rsquo;s important to address a fundamental yet frequently overlooked practice: keeping your software up to date. Regular updates are crucial for protecting against known container escape vulnerabilities, such as <a href=https://snyk.io/blog/cve-2024-21626-runc-process-cwd-container-breakout/ target=_blank rel=noopener>Leaky Vessels</a>
, which often allow attackers to gain root access to the host. This means both the host system and Docker itself must be consistently updated, including the host kernel and Docker Engine.</p><p>Since containers share the host&rsquo;s kernel, a vulnerable kernel exposes all containers to risk. For instance, the <a href=https://github.com/scumjr/dirtycow-vdso target=_blank rel=noopener>Dirty COW kernel privilege escalation exploit</a>
, even if run inside a highly isolated container, would still lead to root access on a vulnerable host.</p><h2 id=user-management-in-docker>User Management in Docker</h2><p>We learnt that if nothing else is configured u user with a container runs as root. Configuring the container to use an unprivileged user is the best way to prevent privilege escalation attacks. This can be accomplished in three different ways.</p><h3 id=run-as-different-user>Run as different user</h3><p>First during runtime using -u option of docker run command, check the differences</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>docker run alpine id
</span></span><span style=display:flex><span>docker run -u guest alpine id
</span></span></code></pre></div><p>Note that the users we are running as must exist in the /etc/passwd of the Docker container. Otherwise, the command will fail as it fails to resolve the username to a user entry in the /etc/passwd file. As an alternative you can run it using an arbitrary uid. In all cases the user must have the necessary rights to execute the binaries or read the files needed in the container. For <code>alpine</code> this works because most binaries are set to read/execute for everyone (755).</p><h3 id=add-user-to-dockerfile>Add USER to Dockerfile</h3><p>A second way is to set it in the image. Simply add user in Dockerfile and use it</p><pre tabindex=0><code>FROM alpine
RUN groupadd -r myuser &amp;&amp; useradd -r -g myuser myuser
#    &lt;HERE DO WHAT YOU HAVE TO DO AS A ROOT USER LIKE INSTALLING PACKAGES ETC.&gt;
USER myuser
</code></pre><p>Let us apply those two ways to our frontend container as well. By checking the process on your local host we see that we started this container, despite our current knowledge, with root privileges:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>docker top frontend
</span></span></code></pre></div><p>Which shows an output like similiar to this:</p><pre tabindex=0><code>UID                 PID                 PPID                C                   STIME               TTY                 TIME                CMD
root                19086               19067               1                   22:45               ?                   00:00:00            /usr/local/bin/python3.9 /usr/local/bin/flask run --host=0.0.0.0 --port=5000
</code></pre><p>Let us stop and start the container with an user which does not exist on the host:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>docker stop frontend
</span></span><span style=display:flex><span>docker rm frontend
</span></span><span style=display:flex><span>docker run -u <span style=color:#0000cf;font-weight:700>1001</span> --name frontend -e <span style=color:#000>username</span><span style=color:#ce5c00;font-weight:700>=</span>peter -e <span style=color:#000>password</span><span style=color:#ce5c00;font-weight:700>=</span>venkman -e <span style=color:#000>servername</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#000>$ip</span> container-lab-frontend:v1.0
</span></span><span style=display:flex><span>docker top frontend
</span></span></code></pre></div><p>Ok, this is fine but even better would be to have it as an default already in the Dockerfile. Please change the Dockerfile of the frontend application to use an new user and build it with a tag of v2.0. Try do do it on you own before checking the solution.</p><details><summary>I'm lost, show me the solution</summary><p>Change your Dockerfile to match the content below:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Use an official Python runtime as a parent image</span>
</span></span><span style=display:flex><span>FROM python:3.12-slim
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Set the working directory</span>
</span></span><span style=display:flex><span>WORKDIR /app
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Install required packages</span>
</span></span><span style=display:flex><span>RUN pip install flask mysql-connector-python
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Create a non-root user and group</span>
</span></span><span style=display:flex><span>RUN groupadd -r appuser <span style=color:#ce5c00;font-weight:700>&amp;&amp;</span> useradd -r -g appuser appuser
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># For the installation we were root, now switch to the non-root user</span>
</span></span><span style=display:flex><span>USER appuser
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Copy the current directory contents into the container at /app</span>
</span></span><span style=display:flex><span>COPY . /app
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Set environment variable for Flask</span>
</span></span><span style=display:flex><span>ENV <span style=color:#000>FLASK_APP</span><span style=color:#ce5c00;font-weight:700>=</span>app.py
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Expose port 5000 for the Flask app</span>
</span></span><span style=display:flex><span>EXPOSE <span style=color:#0000cf;font-weight:700>5000</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Define the default command to run the app with Flask</span>
</span></span><span style=display:flex><span>CMD <span style=color:#ce5c00;font-weight:700>[</span><span style=color:#4e9a06>&#34;flask&#34;</span>, <span style=color:#4e9a06>&#34;run&#34;</span>, <span style=color:#4e9a06>&#34;--host=0.0.0.0&#34;</span>, <span style=color:#4e9a06>&#34;--port=5000&#34;</span><span style=color:#ce5c00;font-weight:700>]</span>
</span></span></code></pre></div><p>Now build it using the tag <code>v2.0</code> make sure you are in the frontend directory:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>docker build -t container-lab-frontend:v2.0 .
</span></span></code></pre></div><p>Now we stop the currently running container and start our new one:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>docker stop frontend
</span></span><span style=display:flex><span>docker rm frontend
</span></span><span style=display:flex><span><span style=color:#204a87>export</span> <span style=color:#000>ip</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#204a87;font-weight:700>$(</span>docker inspect mariadb-container-with-external-volume  -f <span style=color:#4e9a06>&#39;{{ range.NetworkSettings.Networks }}{{ .IPAddress }}{{ end }}&#39;</span><span style=color:#204a87;font-weight:700>)</span>
</span></span><span style=display:flex><span>docker run --name frontend -e <span style=color:#000>username</span><span style=color:#ce5c00;font-weight:700>=</span>peter -e <span style=color:#000>password</span><span style=color:#ce5c00;font-weight:700>=</span>venkman -e <span style=color:#000>servername</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#000>$ip</span> container-lab-frontend:v2.0
</span></span><span style=display:flex><span>docker top frontend
</span></span></code></pre></div></details><h3 id=configure-the-docker-daemon-to-user-user-namespaces>Configure the Docker Daemon to user USER namespaces</h3><p>Both ways to change to user are fine. But what, if need to run an image which requires root privileges inside the container?</p><p>This is where the third option comes into play. It makes use of the Linux USER namespace to re-map the root user within the container to a less-privileged user in the host machine.</p><p>In this way, the container will be running as root, but that root is mapped to an user that has no privileges on the host.
User namespaces are not enabled by default and require to modify the start parametes for the docker deamon.</p><p>More on that topic in the <a href=https://docs.docker.com/engine/security/userns-remap/ target=_blank rel=noopener>official documentation</a>
.</p><p>Other container runtimes like <code>podman</code> automatically enable user-namespaces, there is a excellent article on that topic <a href=https://www.redhat.com/en/blog/understanding-root-inside-and-outside-container target=_blank rel=noopener>here</a>
, if you want to read more.</p><h2 id=why-to-avoid-running-as-root>Why to avoid running as root</h2><p>We learnt that altough we are root in a container there are restrictions like cgroups, namespaces and capabilities in place so why care?</p><p>There are multiple ways gain elevated privileges in docker, by having multiple security layers in depth in place we make it harder for an attacker in case of an exploit or a misconfiguration is in place.</p><p>If you are good on time you can have a look at numerous privilege escalation options <a href=https://book.hacktricks.xyz/linux-hardening/privilege-escalation/docker-security/docker-breakout-privilege-escalation target=_blank rel=noopener>here</a>
.</p><div class=td-page-meta__lastmod>Last modified September 16, 2024: <a href=https://github.com/verysonglaa/k8s-security-training-website/commit/e4db92700afa03c56857d4cb4f8faa78466fbb7f>add more container security labs (e4db927)</a></div></div></main></div></div><footer class="td-footer row d-print-none"><div class=container-fluid><div class="row mx-md-2"><div class="td-footer__left col-6 col-sm-4 order-sm-1"></div><div class="td-footer__right col-6 col-sm-4 order-sm-3"><ul class=td-footer__links-list><li class=td-footer__links-item data-bs-toggle=tooltip title=GitHub aria-label=GitHub><a target=_blank rel=noopener href=https://github.com/verysonglaa/k8s-security-training-website aria-label=GitHub><i class="fab fa-github"></i></a></li></ul></div><div class="td-footer__center col-12 col-sm-4 py-2 order-sm-2"><span class=td-footer__copyright>&copy;
2024
<span class=td-footer__authors>songlaa gmbh</span></span><span class=td-footer__all_rights_reserved>All Rights Reserved</span></div></div></div></footer></div><script src=../../../../../js/main.min.37d14e870feb76f0f7a2a2422bae231efb0186c477999a4ab9ca7e9924ced592.js integrity="sha256-N9FOhw/rdvD3oqJCK64jHvsBhsR3mZpKucp+mSTO1ZI=" crossorigin=anonymous></script><script defer src=../../../../../js/click-to-copy.min.73478a7d4807698aed7e355eb23f9890ca18fea3158604c8471746d046702bad.js integrity="sha256-c0eKfUgHaYrtfjVesj+YkMoY/qMVhgTIRxdG0EZwK60=" crossorigin=anonymous></script><script src=../../../../../js/tabpane-persist.js></script></body></html>