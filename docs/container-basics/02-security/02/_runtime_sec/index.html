<!doctype html><html itemscope itemtype=http://schema.org/WebPage lang=en class=no-js><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><link rel="shortcut icon" href=../../../../../favicons/favicon.ico><link rel=apple-touch-icon href=../../../../../favicons/apple-touch-icon-180x180.png sizes=180x180><link rel=icon type=image/png href=../../../../../favicons/favicon-16x16.png sizes=16x16><link rel=icon type=image/png href=../../../../../favicons/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=../../../../../favicons/android-36x36.png sizes=36x36><link rel=icon type=image/png href=../../../../../favicons/android-48x48.png sizes=48x48><link rel=icon type=image/png href=../../../../../favicons/android-72x72.png sizes=72x72><link rel=icon type=image/png href=../../../../../favicons/android-96x96.png sizes=96x96><link rel=icon type=image/png href=../../../../../favicons/android-144x144.png sizes=144x144><link rel=icon type=image/png href=../../../../../favicons/android-192x192.png sizes=192x192><title>2.8 Container Runtime Security | Container Security Training</title>
<meta name=description content="Do the following commands and outputs carefully:
user1@localhost$ whoami user1@localhost$ head -1 /etc/shadow Now do this:
docker run -v /etc:/host alpine sh -c &amp;#39;whoami;head -1 /host/shadow&amp;#39; Why can you suddenly read stuff which you shouldn&amp;rsquo;t be allowed to? Are containers not restriced? The answer lies in the architecture of Docker:
By default the Docker Deamon runs in root mode without user namespaces enabled. This means we can mount anything from the host into our container and change it there too using the root user inside our container."><meta property="og:title" content="2.8 Container Runtime Security"><meta property="og:description" content="Do the following commands and outputs carefully:
user1@localhost$ whoami user1@localhost$ head -1 /etc/shadow Now do this:
docker run -v /etc:/host alpine sh -c 'whoami;head -1 /host/shadow' Why can you suddenly read stuff which you shouldn&rsquo;t be allowed to? Are containers not restriced? The answer lies in the architecture of Docker:
By default the Docker Deamon runs in root mode without user namespaces enabled. This means we can mount anything from the host into our container and change it there too using the root user inside our container."><meta property="og:type" content="article"><meta property="og:url" content="/docs/container-basics/02-security/02/_runtime_sec/"><meta property="article:section" content="docs"><meta property="article:modified_time" content="2024-10-22T18:00:35+02:00"><meta itemprop=name content="2.8 Container Runtime Security"><meta itemprop=description content="Do the following commands and outputs carefully:
user1@localhost$ whoami user1@localhost$ head -1 /etc/shadow Now do this:
docker run -v /etc:/host alpine sh -c 'whoami;head -1 /host/shadow' Why can you suddenly read stuff which you shouldn&rsquo;t be allowed to? Are containers not restriced? The answer lies in the architecture of Docker:
By default the Docker Deamon runs in root mode without user namespaces enabled. This means we can mount anything from the host into our container and change it there too using the root user inside our container."><meta itemprop=dateModified content="2024-10-22T18:00:35+02:00"><meta itemprop=wordCount content="473"><meta itemprop=keywords content><meta name=twitter:card content="summary"><meta name=twitter:title content="2.8 Container Runtime Security"><meta name=twitter:description content="Do the following commands and outputs carefully:
user1@localhost$ whoami user1@localhost$ head -1 /etc/shadow Now do this:
docker run -v /etc:/host alpine sh -c 'whoami;head -1 /host/shadow' Why can you suddenly read stuff which you shouldn&rsquo;t be allowed to? Are containers not restriced? The answer lies in the architecture of Docker:
By default the Docker Deamon runs in root mode without user namespaces enabled. This means we can mount anything from the host into our container and change it there too using the root user inside our container."><link rel=preload href=../../../../../scss/main.min.adaeead791a8f109b4559b249a7a020bb877ffc11fefeb15be29f9b5a0346557.css as=style><link href=../../../../../scss/main.min.adaeead791a8f109b4559b249a7a020bb877ffc11fefeb15be29f9b5a0346557.css rel=stylesheet integrity><script src=https://code.jquery.com/jquery-3.7.1.min.js integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin=anonymous></script><script defer src=https://unpkg.com/lunr@2.3.9/lunr.min.js integrity=sha384-203J0SNzyqHby3iU6hzvzltrWi/M41wOP5Gu+BiJMz5nwKykbkUx8Kp7iti0Lpli crossorigin=anonymous></script></head><body class=td-page><header><nav class="td-navbar js-navbar-scroll" data-bs-theme=dark><div class="container-fluid flex-column flex-md-row"><a class=navbar-brand href=../../../../../><span class="navbar-brand__logo navbar-logo"></span><span class=navbar-brand__name>Container Security Training</span></a><div class="td-navbar-nav-scroll ms-md-auto" id=main_navbar><ul class=navbar-nav><li class=nav-item><a class=nav-link href=../../../../../setup/><span>Setup</span></a></li><li class=nav-item><a class="nav-link active" href=../../../../../docs/><span>Labs</span></a></li><li class=nav-item><a class=nav-link href=../../../../../slides/><span>Slides</span></a></li><li class=nav-item><a class=nav-link href=https://songlaa.com target=_blank rel=noopener><span>songlaa gmbh</span></a></li></ul></div><div class="d-none d-lg-block"><div class="td-search td-search--offline"><div class=td-search__icon></div><input type=search class="td-search__input form-control" placeholder="Search this site…" aria-label="Search this site…" autocomplete=off data-offline-search-index-json-src=../../../../../offline-search-index.af4d21e7335b63483faff699ba802efb.json data-offline-search-base-href=../../../../../ data-offline-search-max-results=10></div></div></div></nav></header><div class="container-fluid td-outer"><div class=td-main><div class="row flex-xl-nowrap"><aside class="col-12 col-md-3 col-xl-2 td-sidebar d-print-none"><div id=td-sidebar-menu class=td-sidebar__inner><form class="td-sidebar__search d-flex align-items-center"><div class="td-search td-search--offline"><div class=td-search__icon></div><input type=search class="td-search__input form-control" placeholder="Search this site…" aria-label="Search this site…" autocomplete=off data-offline-search-index-json-src=../../../../../offline-search-index.af4d21e7335b63483faff699ba802efb.json data-offline-search-base-href=../../../../../ data-offline-search-max-results=10></div><button class="btn btn-link td-sidebar__toggle d-md-none p-0 ms-3 fas fa-bars" type=button data-bs-toggle=collapse data-bs-target=#td-section-nav aria-controls=td-section-nav aria-expanded=false aria-label="Toggle section navigation"></button></form><nav class="td-sidebar-nav collapse" id=td-section-nav><ul class="td-sidebar-nav__section pe-md-3 ul-0"><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child active-path" id=m-docs-li><a href=../../../../../docs/ class="align-left ps-0 td-sidebar-link td-sidebar-link__section tree-root" id=m-docs><span>Labs</span></a><ul class=ul-1><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-docscontainer-basics01-basics-li><a href=../../../../../docs/container-basics/01-basics/ class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id=m-docscontainer-basics01-basics><span>1. 1. Docker Basics</span></a><ul class="ul-2 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docscontainer-basics01-basics01_images-li><a href=../../../../../docs/container-basics/01-basics/01/_images/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-docscontainer-basics01-basics01_images><span>1.1. 1.1 Images</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docscontainer-basics01-basics01_env-vars-li><a href=../../../../../docs/container-basics/01-basics/01/_env-vars/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-docscontainer-basics01-basics01_env-vars><span>1.2. 1.2 Environment variables</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docscontainer-basics01-basics01_frontend-li><a href=../../../../../docs/container-basics/01-basics/01/_frontend/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-docscontainer-basics01-basics01_frontend><span>1.3. 1.3 Frontend</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docscontainer-basics01-basics01_dockerfile-li><a href=../../../../../docs/container-basics/01-basics/01/_dockerfile/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-docscontainer-basics01-basics01_dockerfile><span>1.4. 1.4 Dockerfile</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docscontainer-basics01-basics01_dockerfile_ms-li><a href=../../../../../docs/container-basics/01-basics/01/_dockerfile_ms/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-docscontainer-basics01-basics01_dockerfile_ms><span>1.5. 1.5 MultiStage Build</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docscontainer-basics01-basics01_deepdive-li><a href=../../../../../docs/container-basics/01-basics/01/_deepdive/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-docscontainer-basics01-basics01_deepdive><span>1.6. 1.6 Under the hood</span></a></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child active-path" id=m-docscontainer-basics02-security-li><a href=../../../../../docs/container-basics/02-security/ class="align-left ps-0 td-sidebar-link td-sidebar-link__section" id=m-docscontainer-basics02-security><span>2. 2. Securing Containers</span></a><ul class="ul-2 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docscontainer-basics02-security02_ssdlc-li><a href=../../../../../docs/container-basics/02-security/02/_ssdlc/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-docscontainer-basics02-security02_ssdlc><span>2.1. 2.1 SSDLC</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docscontainer-basics02-security02_root-li><a href=../../../../../docs/container-basics/02-security/02/_root/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-docscontainer-basics02-security02_root><span>2.2. 2.2 Avoid Root</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docscontainer-basics02-security02_capabilities-li><a href=../../../../../docs/container-basics/02-security/02/_capabilities/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-docscontainer-basics02-security02_capabilities><span>2.3. 2.3 Capabilities</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docscontainer-basics02-security02_volumes-li><a href=../../../../../docs/container-basics/02-security/02/_volumes/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-docscontainer-basics02-security02_volumes><span>2.4. 2.4 Volume security</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docscontainer-basics02-security02_lsm-li><a href=../../../../../docs/container-basics/02-security/02/_lsm/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-docscontainer-basics02-security02_lsm><span>2.5. 2.6 Linux Security Modules</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docscontainer-basics02-security02_privileged-mode-li><a href=../../../../../docs/container-basics/02-security/02/_privileged-mode/ class="align-left ps-0 td-sidebar-link td-sidebar-link__page" id=m-docscontainer-basics02-security02_privileged-mode><span>2.6. 2.7 Privileged Containers</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child active-path" id=m-docscontainer-basics02-security02_runtime_sec-li><a href=../../../../../docs/container-basics/02-security/02/_runtime_sec/ class="align-left ps-0 active td-sidebar-link td-sidebar-link__page" id=m-docscontainer-basics02-security02_runtime_sec><span class=td-sidebar-nav-active-item>2.7. 2.8 Container Runtime Security</span></a></li></ul></li></ul></li></ul></nav></div></aside><aside class="d-none d-xl-block col-xl-2 td-sidebar-toc d-print-none"><div class="td-page-meta ms-2 pb-1 pt-2 mb-0"><a href=https://github.com/verysonglaa/k8s-security-training-website/tree/main/content/en/docs/container-basics/02-Security/02/_runtime_sec.md class="td-page-meta--view td-page-meta__view" target=_blank rel=noopener><i class="fa-solid fa-file-lines fa-fw"></i> View page source</a>
<a href=https://github.com/verysonglaa/k8s-security-training-website/edit/main/content/en/docs/container-basics/02-Security/02/_runtime_sec.md class="td-page-meta--edit td-page-meta__edit" target=_blank rel=noopener><i class="fa-solid fa-pen-to-square fa-fw"></i> Edit this page</a>
<a href="https://github.com/verysonglaa/k8s-security-training-website/new/main/content/en/docs/container-basics/02-Security/02?filename=change-me.md&amp;value=---%0Atitle%3A+%22Long+Page+Title%22%0AlinkTitle%3A+%22Short+Nav+Title%22%0Aweight%3A+100%0Adescription%3A+%3E-%0A+++++Page+description+for+heading+and+indexes.%0A---%0A%0A%23%23+Heading%0A%0AEdit+this+template+to+create+your+new+page.%0A%0A%2A+Give+it+a+good+name%2C+ending+in+%60.md%60+-+e.g.+%60getting-started.md%60%0A%2A+Edit+the+%22front+matter%22+section+at+the+top+of+the+page+%28weight+controls+how+its+ordered+amongst+other+pages+in+the+same+directory%3B+lowest+number+first%29.%0A%2A+Add+a+good+commit+message+at+the+bottom+of+the+page+%28%3C80+characters%3B+use+the+extended+description+field+for+more+detail%29.%0A%2A+Create+a+new+branch+so+you+can+preview+your+new+file+and+request+a+review+via+Pull+Request.%0A" class="td-page-meta--child td-page-meta__child" target=_blank rel=noopener><i class="fa-solid fa-pen-to-square fa-fw"></i> Create child page</a>
<a href="https://github.com/verysonglaa/k8s-security-training-website/issues/new?title=2.8%20Container%20Runtime%20Security" class="td-page-meta--issue td-page-meta__issue" target=_blank rel=noopener><i class="fa-solid fa-list-check fa-fw"></i> Create documentation issue</a></div><div class=td-toc><nav id=TableOfContents><ul><li><a href=#recap>Recap</a></li></ul></nav></div></aside><main class="col-12 col-md-9 col-xl-8 ps-md-5" role=main><nav aria-label=breadcrumb class=td-breadcrumbs><ol class=breadcrumb><li class=breadcrumb-item><a href=../../../../../docs/>Labs</a></li><li class=breadcrumb-item><a href=../../../../../docs/container-basics/02-security/>2. Securing Containers</a></li><li class="breadcrumb-item active" aria-current=page>2.8 Container Runtime Security</li></ol></nav><div class=td-content><h1>2.7. 2.8 Container Runtime Security</h1><header class=article-meta></header><p>Do the following commands and outputs carefully:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>user1@localhost$ whoami
</span></span><span style=display:flex><span>user1@localhost$ head -1 /etc/shadow
</span></span></code></pre></div><p>Now do this:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>docker run -v /etc:/host alpine sh -c <span style=color:#4e9a06>&#39;whoami;head -1 /host/shadow&#39;</span>
</span></span></code></pre></div><p>Why can you suddenly read stuff which you shouldn&rsquo;t be allowed to?
Are containers not restriced? The answer lies in the architecture of Docker:</p><p><img alt="Docker Architecture" src=../docker-architecture.png></p><p>By default the Docker Deamon runs in root mode without user namespaces enabled.
This means we can mount anything from the host into our container and change it there too using the root user inside our container.</p><p>It gets worse, just read the exerpt below as we don&rsquo;t have sudo installed in our webshell:</p><pre tabindex=0><code>user2@localhost$ whoami
user2
user2@localhost$ sudo su
Sorry, user user2 may not rund sudo on localhost.
user2@localhost$ docker run --rm -it -v /etc/sudoers.d:/host/etc/sudoers.d alpine sh
/ # echo &#39;user2 ALL=(ALL) NOPASSWD:ALL&#39; &gt; /host/etc/sudoers.d/user2
/ # exit
user2@localhost$ sudo su
root@localhost$ whoami
root
</code></pre><p>To ensure that a user running a container doesn&rsquo;t gain root access to your host, you need to run the container engine and the containerized process as a non-root user. This provides multiple layers of security between the service (httpd, MySQL, etc.) and the privileged resources in the operating system.</p><p>Running the container engine as a non-root user, is one layer of defense, while running the process in the container as a different non-root user offers yet another layer of defense.</p><p>Here is an except from the <a href=https://docs.docker.com/engine/security/rootless/ target=_blank rel=noopener>docs</a>
:
Rootless mode executes the Docker daemon and containers inside a user namespace. This is very similar to userns-remap mode, except that with userns-remap mode, the daemon itself is running with root privileges, whereas in rootless mode, both the daemon and the container are running without root privileges.</p><p>Running rootless mode in Docker comes with a set of limitations, most notably that not all storage drivers are allowed and AppArmor is not supported.</p><p>Another solution would be to switch from Docker to <a href=https://podman.io target=_blank rel=noopener>Podman</a>
.</p><p>While Docker relies on a client-server model, Podman employs a daemonless architecture. With Podman&rsquo;s approach, users manage containers directly, eliminating the need for a continuous daemon process in the background.</p><p>Compared to Docker is has stronger default security settings, features like rootless containers, user namespaces, and seccomp profiles are enabled by default. On the image below we see a comparisation between Docker and Podman architecture</p><p><img alt="Podman Architecture, src: https://dev.to/arafetki" src=../podman-architecture.jpeg></p><h2 id=recap>Recap</h2><p>We saw how to run containers and how to secure them avoiding root, dropping capabilites, mounting filesystems readonly and using Linux Security Modules such as seccomp. However it is important to say that because of the architecture of docker anyone who can start container has more privileges on the host. It is still important to secure the Host Operating system and maybe to run a deamonless container technology like <code>podname</code>. What we did not touch are things like network security and monitoring. More an that in the Kubernetes Security lab.</p><div class="text-muted mt-5 pt-3"><div class=row><div class=col-sm><a href=../../../../../docs/container-basics/02-security/02/_privileged-mode/ data-toggle=tooltip title="2.7 Privileged Containers"><i class="fa fa-arrow-circle-left"></i> Previous</a></div><div class="col-sm text-right"><a href=../../../../../slides/ data-toggle=tooltip title=Slides>Next <i class="fa fa-arrow-circle-right"></i></a></div></div></div><div class=td-page-meta__lastmod>Last modified October 22, 2024: <a href=https://github.com/verysonglaa/k8s-security-training-website/commit/1c189ea1ef799657ba169f3939abe66cae4ecfaf>improvment on labs (1c189ea)</a></div></div></main></div></div><footer class="td-footer row d-print-none"><div class=container-fluid><div class="row mx-md-2"><div class="td-footer__left col-6 col-sm-4 order-sm-1"></div><div class="td-footer__right col-6 col-sm-4 order-sm-3"><ul class=td-footer__links-list><li class=td-footer__links-item data-bs-toggle=tooltip title=GitHub aria-label=GitHub><a target=_blank rel=noopener href=https://github.com/verysonglaa/k8s-security-training-website aria-label=GitHub><i class="fab fa-github"></i></a></li></ul></div><div class="td-footer__center col-12 col-sm-4 py-2 order-sm-2"><span class=td-footer__copyright>&copy;
2024
<span class=td-footer__authors>songlaa gmbh</span></span><span class=td-footer__all_rights_reserved>All Rights Reserved</span></div></div></div></footer></div><script src=../../../../../js/main.min.37d14e870feb76f0f7a2a2422bae231efb0186c477999a4ab9ca7e9924ced592.js integrity="sha256-N9FOhw/rdvD3oqJCK64jHvsBhsR3mZpKucp+mSTO1ZI=" crossorigin=anonymous></script><script defer src=../../../../../js/click-to-copy.min.73478a7d4807698aed7e355eb23f9890ca18fea3158604c8471746d046702bad.js integrity="sha256-c0eKfUgHaYrtfjVesj+YkMoY/qMVhgTIRxdG0EZwK60=" crossorigin=anonymous></script><script src=../../../../../js/tabpane-persist.js></script><script src=../../../../../js/site.min.1b86eee028c038e3c091bb0e4a5f11d864071cfddfac37a5b7d7dc4b7af9bd0a.js integrity="sha256-G4bu4CjAOOPAkbsOSl8R2GQHHP3frDelt9fcS3r5vQo=" crossorigin=anonymous></script></body></html>