[{"body":"\nWelcome to the Kubernetes Security training!","categories":"","description":"","excerpt":"\nWelcome to the Kubernetes Security training!","ref":"/docs/","tags":"","title":"Labs"},{"body":" Kubernetes Security Basics Read more\nLab PDF Read more\n","categories":"","description":"","excerpt":" Kubernetes Security Basics Read more\nLab PDF Read more\n","ref":"/slides/","tags":"","title":"Slides"},{"body":"Install K8s ","categories":"","description":"","excerpt":"Install K8s ","ref":"/docs/getting-started/","tags":"","title":"Getting Started"},{"body":"Table of Contents Introduction Prerequisites Namespaces PID Namespace Network Namespace Mount Namespace Seccomp AppArmor SELinux Cgroups Additional Security Practices Conclusion Introduction In this lab, you will learn about various security mechanisms available in Docker and containers, including namespaces, seccomp, AppArmor, SELinux, and cgroups. You will also learn how containers communicate with the Linux kernel and how to secure this communication.\nPrerequisites A system with Docker installed (preferably a Linux system) Basic knowledge of Docker and Linux commands Namespaces Namespaces are one of the fundamental building blocks of container isolation. They provide isolated instances of global system resources, ensuring processes inside a container do not interfere with processes outside the container or in other containers.\nPID Namespace Theoretical Introduction: PID namespaces isolate the process ID number space, meaning that processes in different PID namespaces can have the same PID. This is essential for containers, as it allows each container to have its own init process (PID 1).\nFamous Exploits: There have been vulnerabilities related to improper handling of PID namespaces that could potentially lead to privilege escalation, such as CVE-2013-1763.\nExercise:\n# Run a container in detached mode docker run -d --name test-container nginx # Enter the container's namespace docker exec -it test-container bash # Inside the container, check the process tree ps aux # From another terminal, check the process tree on the host ps aux | grep test-container Network Namespace Theoretical Introduction: Network namespaces provide isolated network stacks, including interfaces, IP addresses, routing tables, and firewall rules. This allows each container to have its own network interfaces and IP addresses.\nFamous Exploits: Exploits can occur if containers are allowed to access the host’s network namespace improperly. For example, CVE-2020-14386 was a Linux kernel vulnerability that could allow container escape through the network namespace.\nExercise:\n# Check network interfaces on the host ip a # Enter the container's network namespace docker exec -it test-container bash # Inside the container, check network interfaces ip a Mount Namespace Theoretical Introduction: Mount namespaces isolate the set of filesystem mount points seen by processes. Changes to mounts in one namespace are not visible to other namespaces, which helps in providing file system isolation.\nFamous Exploits: Improper mount namespace configurations can lead to vulnerabilities like CVE-2014-5206, where an attacker could escape the container by exploiting mounts.\nExercise:\n# Inside the container, create a new file docker exec -it test-container touch /tmp/container-file # Check if the file is present on the host ls /var/lib/docker/containers/\u003ccontainer-id\u003e/mnt/tmp/ # It won't be there because the mount namespace is isolated Seccomp Theoretical Introduction: Seccomp (secure computing mode) is a security feature in the Linux kernel that restricts the system calls a process can make. This helps in limiting the attack surface by disallowing unnecessary or dangerous system calls.\nFamous Exploits: Seccomp has mitigated several kernel vulnerabilities, such as CVE-2014-0038, where improper system call handling could lead to privilege escalation.\nExercise:\n# Run a container with a custom seccomp profile cat \u003c\u003cEOF \u003e my-seccomp-profile.json { \"defaultAction\": \"SCMP_ACT_ERRNO\", \"syscalls\": [ { \"names\": [\"clone\", \"fork\", \"vfork\"], \"action\": \"SCMP_ACT_ALLOW\" } ] } EOF docker run --security-opt seccomp=my-seccomp-profile.json nginx AppArmor Theoretical Introduction: AppArmor (Application Armor) is a Linux security module that provides mandatory access control. It confines programs to a limited set of resources based on a specified profile.\nFamous Exploits: AppArmor has helped mitigate vulnerabilities like CVE-2016-9962, where a misconfigured profile could allow an attacker to escape the Docker container.\nExercise:\n# Check the current AppArmor profiles sudo aa-status # Run a container with a custom AppArmor profile docker run --security-opt \"apparmor=your_profile\" nginx SELinux Theoretical Introduction: SELinux (Security-Enhanced Linux) is another Linux security module providing mandatory access control. It uses security policies to define how processes and users can access resources.\nFamous Exploits: SELinux has been crucial in preventing exploits such as CVE-2017-5123, which could allow a process to gain unauthorized access to system resources.\nExercise:\n# Check the SELinux status sestatus # Run a container with a specific SELinux label docker run --security-opt label:type:your_type nginx Cgroups Theoretical Introduction: Cgroups (control groups) limit, account for, and isolate the resource usage of process groups. This includes CPU, memory, disk I/O, and network bandwidth.\nFamous Exploits: Misconfigurations in cgroups can lead to denial of service attacks, such as CVE-2014-3519, where an attacker could cause excessive resource consumption.\nExercise:\n# Run a container with limited CPU and memory docker run -d --name limited-container --cpus=\".5\" --memory=\"256m\" nginx # Check the resource usage docker stats limited-container Additional Security Practices Theoretical Introduction: In addition to the above mechanisms, there are several best practices to follow to enhance container security. These include using minimal base images, keeping images up to date, scanning images for vulnerabilities, and running containers as non-root users.\nExercise:\n# Example of running a container as a non-root user docker run -u 1000:1000 nginx Conclusion In this lab, you explored various aspects of Docker/container security, including namespaces, seccomp, AppArmor, SELinux, and cgroups. By following these practices and utilizing these tools, you can enhance the security of your containerized applications.\n","categories":"","description":"","excerpt":"Table of Contents Introduction Prerequisites Namespaces PID Namespace …","ref":"/docs/container/container/","tags":"","title":"Docker/Container Security"},{"body":"","categories":"","description":"","excerpt":"","ref":"/categories/","tags":"","title":"Categories"},{"body":" Welcome to the Kubernetes Security Training Setup Labs Slides ","categories":"","description":"","excerpt":" Welcome to the Kubernetes Security Training Setup Labs Slides ","ref":"/","tags":"","title":"Kubernetes Security Training"},{"body":"","categories":"","description":"","excerpt":"","ref":"/tags/","tags":"","title":"Tags"}]